## 简介
业务目标是解决降本增效自动化场景最后的拦路虎：识别变长不规则的验证码（字母或数字）

分享内容：机器学习调研过程，基础的机器学习知识

## 第三方工具调研

* 遇到的问题
    * 付费跟不准
* 原因：结果很不准，需要付费
    * 成熟开源的 OCR 只能识别比较规整的字母
* 结果：不选择，决定找开源模型，自己训练
    * 网上模型很多，需要选出，改造成合适本需求的

## CNN 调研
寻找到并调研了的[CNN 模型](https://github.com/nickliqian/cnn_captcha)，赞数比较多，应该靠谱

### 技术
模型实现：Tensorflow 框架的 CNN

* CNN（Convolutional Neural Network 卷积神经网络） 做图片特征提取
* 定长编码：one hot编码，将离散的分类数据转换为神经网络等模型可以处理的向量表示。如果编码是 4 位，则是一个识别 4 位字符的分类任务
* 交叉熵损失函数推动反向传播


### 遇到的问题
阅读源码后判断只能做定长识别，然而咱的拦路虎是变长的

* 处理变长可能方案：裁剪，切割，并一个个识别文本
    * 原因：图片背景有噪声，导致对图片进行切割困难，可能会损失一些文本细节导致识别不准。
    * 结果：问 chatGPT 找到 CRNN 模型

## CRNN 调研
寻找到并调研的[CRNN 模型](https://github.com/GitYCC/crnn-pytorch)，赞数相对 CNN 少了一个量级，但是看起来很顺眼

### 技术
Pytorch 框架的 CNN + LSTM(RNN)(Long-short term memory 一种特殊的循环神经网络) + CTC

* CNN 做图片特征提取
* RNN 对 CNN 提取的特征序列进行预测，利用上下文信息**提高识别的准确性**；
        * 对于 RNN 的作用
            * 作用1（字符内部像素序列）：对于常见的随机顺序验证码，RNN 通过处理构成字符的像素序列并捕捉序列中的特征信息，学习到字符的局部和全局特征，包括形状、纹理、笔画等信息，从而提升判定字符的准确率。
            * 作用2（字符序列）：对于非随机顺序验证码，对于一些相似或者易混淆的字符，RNN可以根据前后的字符来判断最可能的结果。例如，如果验证码中有一个字符“l”，它可能是字母“l”或者数字“1”，但是如果前面的字符是“o”，并且训练数据中经常出现 ol，那么RNN就可以推断出它更可能是字母“l”；也即 RNN 能够在大样本中寻找到生成验证码序列的一些可能得规律，从而增加准确性
        * PS：定长任务中可以理解成是对 CNN 识别能力的增强？
            
* CTC 对 RNN 的输出序列对齐 + 计算损失驱动梯度下降反向传播
    * CTC 算法不需要训练数据对齐，它会把所有相同输出的对齐合并。可以对变长做对齐处理

阅读源码后判断可以做变长序列识别

### 遇到的问题

* 真实样本数不足；当时 1k 多的标注数据还不足以直接训练出效果（发动人民群众帮忙标注前提是得看到效果）
* 猜想：是否可以微调？
    * 理论：迁移学习跟特征共享
        * 例子：九年义务教育中老师口中的举一反三，先学到如何使用公司（底层特征），然后套公式（知识迁移）；机器学习也可以通过其他样本（与真实样本共享一些特征）的学习积累底层特征，然后应用到少量样本加速学习过程
* 猜想实践：
    * 改造数据加载器,调试模型参数,潜在BUG修改
    * 用第三方库使用同样的字符集生成6万张验证码样本，4,5,6长度分别是 2万张，划分为训练 57k + 测试集 30k，花费17个小时训练出参数模型 A.pt
        * 效果：识别自身测试集准确率 90% 左右
    * 基于 A.pt 的参数，使用 1k 多的标注数据进行训练模型 B.pt
        * 效果：损失率下降很快，3个小时，达到准确率 44% 左右
    * 发动人民群众帮忙标注真实数据，目前达到准确率 75% 左右（训练集3k，测试集 250）
    * 将模型识别部署成 python 服务

## References
* https://github.com/GitYCC/crnn-pytorch


