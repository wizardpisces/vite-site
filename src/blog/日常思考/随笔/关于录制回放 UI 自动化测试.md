采用无头浏览器录制并生成指令、通过指令进行回放的E2E测试方法

# 优势

## **快速创建用例**：
  * 录制回放使测试人员可以通过“点击录制”的方式快速生成测试用例，特别适合快速构建原型或初期测试套件。无需编写代码，即可让开发者和非技术人员更快地上手并生成测试。

## **降低技术门槛**：
  * 对于不擅长编程的测试人员或需要快速验证的业务团队，录制回放提供了友好的界面，简化了自动化测试的创建过程，使团队成员不必深入代码也能执行测试任务。

## **直观的流程记录**：
  * 录制回放能够直观地记录用户交互流程，帮助测试人员清晰了解操作步骤和测试覆盖面。回放的过程可以重现用户路径和行为，对于UI验证和简单交互流程来说非常有效。

## **提高测试效率**：
  * 录制回放可以在短时间内生成多个测试用例，减少了手动测试的工作量，特别适合快速迭代的场景中进行大量重复性测试，从而加速了测试执行效率。

## **即时反馈**：
  * 录制生成的指令可以快速回放并检查页面状态，这使得测试人员在开发阶段更快发现和修复UI或功能问题，是一种非常有利的即时反馈机制。

## **适合回归测试**：
  * 在简单或变化较少的场景下，录制回放的指令具有重复性和可预测性，可以快速检测页面在更新后的稳定性，帮助维护产品质量。

# 挑战和痛点

## **用例的维护成本高**：
  * 录制的回放用例很依赖UI布局和元素选择器，一旦页面结构或元素发生变动，测试就可能失效。
    * 解决方案：增加元素选择器匹配的容错能力，比如增加元素的文本、属性等匹配条件。[例如匹配算法](https://dl.acm.org/doi/10.1145/3571855)
  * 频繁的UI调整会导致录制的脚本频繁报错，迫使测试团队不断维护和更新这些脚本，这就降低了E2E自动化的实际效益。
    * 解决方案：增加用例步骤的 group 能力，对可复用的步骤进行组装，减少重复劳动。

## **缺乏模块化**：
  * 录制生成的指令通常是连续的、线性化的，不具备代码模块化或复用的特性。对于复杂场景，如重复性操作或不同页面之间的跳转，无法灵活复用代码块来简化测试流程，也使得测试脚本难以在不同场景下复用和维护。
    * 解决方案：增加用例步骤的 group 能力，对可复用的步骤进行组装，减少重复劳动。

## **缺乏灵活性和逻辑控制**：
  * 无代码的录制回放方式通常缺少逻辑控制能力，比如条件分支或复杂的用户行为模拟。回放指令可能无法完全覆盖复杂的业务逻辑需求，而仅适用于较为简单的测试场景。此外，这类录制方式缺乏数据驱动，无法轻松使用不同的数据进行多样化测试。

## **调试困难**：
  * 录制的指令在出错时，缺少代码中的细粒度调试信息，测试人员难以快速定位问题。在无代码环境中，调试往往只能靠指令执行日志，很难直接观察变量、回调或异步事件的执行情况。

## **性能瓶颈**：
  * 无头浏览器的录制和回放通常包含所有用户行为的逐步指令，这种方式相比手写代码，运行速度较慢，尤其在大型测试套件中，可能拖慢持续集成（CI）流程。此外，回放过程中任何冗余的指令都会带来额外开销。

## **复杂交互支持不足**：
  * 无头浏览器录制在处理拖拽、动态内容加载和异步请求等复杂操作时存在局限性。生成的指令往往无法准确模拟这类复杂交互，导致测试的可靠性下降。

## **自动化环境的差异**：
  * 测试脚本在本地和CI/CD环境中的表现可能不同，因为环境变量、服务器配置或网络延迟等因素会影响回放结果。录制回放的指令在自动化环境中可能不稳定，尤其是在处理延时或资源加载时，导致测试结果不一致。

## **维护多版本的难度**：
  * 对于需要支持多个版本的应用，录制的指令回放面临管理和维护困难。应用升级后，指令往往需要针对每个版本调整，尤其在UI和功能频繁更新的情况下，测试用例的复用性差，导致维护成本上升。
  
## **测试覆盖面有限**：
  * 录制回放主要关注页面UI和用户交互流程，通常难以覆盖API、后台处理、数据库等方面的测试。如果后端服务或API有更新，前端测试的稳定性可能会受到影响，但录制回放指令无法直接涵盖这些测试维度，限制了整体的覆盖范围。
    * 解决方案：录制过程拦截 requests 收集 data，然后在回放时匹配支持 mock data，以此保证数据的稳定性

## **缺乏数据驱动和逻辑控制**：
  * 大多数录制回放工具生成的用例是单一、固定的数据流，不具备数据驱动能力。测试人员无法轻松在不同数据条件下运行相同的用例，限制了测试的覆盖面，且不容易控制复杂的条件和分支逻辑。
    * 录制不同用户全链路，从而模拟不同条件分支逻辑的案例（需要改造被录制的工程，支持 user 的快速切换）
