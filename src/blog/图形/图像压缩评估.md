# 图像压缩质量评估
压缩后的图像质量是评估压缩算法的重要指标。常用的图像质量评估方法包括主观评估和客观评估。这里只进行客观评估的讨论

客观评估：
* 峰值信噪比（PSNR）
* 结构相似性指数（SSIM）

## 峰值信噪比（PSNR）

公式中最大像素值（MAX）的作用对于全面理解 PSNR 的计算过程至关重要。让我们详细解释一下这个概念。

### 1. PSNR 公式

PSNR 的计算公式为：

$$
\text{PSNR} = 10 \cdot \log_{10} \left( \frac{\text{MAX}^2}{\text{MSE}} \right)
$$

其中：
- \(\text{MSE}\) 是均方误差，表示原始图像和压缩图像之间的平均像素差异。
- \(\text{MAX}\) 是图像的最大像素值。

### 2. MAX 的定义

MAX 是图像中像素值的最大可能值。对于不同的图像类型，MAX 的值不同：
- 对于 8 位灰度图像，像素值范围是 0 到 255，因此 MAX = 255。
- 对于 16 位图像，像素值范围是 0 到 65535，因此 MAX = 65535。

### 3. MAX 在 PSNR 公式中的作用

#### 3.1 标准化误差

MAX 的主要作用是标准化均方误差（MSE），使得 PSNR 值可以在不同图像类型之间进行比较。直接使用 MSE 可能会导致不同图像类型之间的比较不公平，因为它们的像素值范围不同。

#### 3.2 无量纲化

通过将 MSE 除以 MAX 的平方，PSNR 公式消除了像素值范围的影响，使得计算结果无量纲化。这意味着无论图像的像素值范围如何，PSNR 值都可以在相同的尺度上进行解释。

#### 3.3 对数尺度

PSNR 使用对数尺度来表示误差，这使得它对人类感知更直观。对数变换可以压缩大范围的误差值，使得较小的误差变化更容易被察觉。

### 4. 举例说明

假设我们有两张 8 位灰度图像，原始图像和压缩图像，其 MSE 为 100。计算 PSNR 的步骤如下：

#### 4.1 计算 MSE

$$
\text{MSE} = 100
$$

#### 4.2 计算 MAX 的平方

对于 8 位灰度图像：

$$
\text{MAX} = 255
$$

$$
\text{MAX}^2 = 255^2 = 65025
$$

#### 4.3 计算 PSNR

$$
\text{PSNR} = 10 \cdot \log_{10} \left( \frac{65025}{100} \right)
$$

$$
\text{PSNR} = 10 \cdot \log_{10} (650.25)
$$

$$
\text{PSNR} \approx 10 \cdot 2.813 = 28.13 \text{ dB}
$$

### 5. 总结

通过引入 MAX，PSNR 公式能够：
- 标准化误差，使得不同图像类型之间的比较成为可能。
- 无量纲化误差，使得 PSNR 值在同一尺度上进行解释。
- 使用对数尺度，使得较小的误差变化更容易被察觉。

MAX 的引入确保了 PSNR 是一个可靠且一致的图像质量评估指标，无论图像的像素值范围如何，它都能提供一个直观的质量度量。

## 结构相似性指数（SSIM）

结构相似性指数（SSIM，Structural Similarity Index）是一种用于衡量两幅图像之间相似性的指标，特别适用于评估图像质量。与峰值信噪比（PSNR）不同，SSIM 更加注重图像的结构信息，因此在反映人类视觉感知方面更为有效。以下是详细说明：

### 1. SSIM 的基本原理

SSIM 通过比较图像的亮度、对比度和结构来评估图像质量。其公式如下：

$$
\text{SSIM}(x, y) = \frac{(2 \mu_x \mu_y + C_1)(2 \sigma_{xy} + C_2)}{(\mu_x^2 + \mu_y^2 + C_1)(\sigma_x^2 + \sigma_y^2 + C_2)}
$$

其中：
- \( \mu_x \) 和 \( \mu_y \) 分别是图像 \( x \) 和 \( y \) 的平均值。
- \( \sigma_x^2 \) 和 \( \sigma_y^2 \) 分别是图像 \( x \) 和 \( y \) 的方差。
- \( \sigma_{xy} \) 是图像 \( x \) 和 \( y \) 的协方差。
- \( C_1 \) 和 \( C_2 \) 是为了稳定分母而引入的小常数。

### 2. SSIM 的三个组成部分

#### 2.1 亮度比较（Luminance Comparison）

$$
l(x, y) = \frac{2 \mu_x \mu_y + C_1}{\mu_x^2 + \mu_y^2 + C_1}
$$

亮度比较部分衡量两幅图像的平均亮度差异。

#### 2.2 对比度比较（Contrast Comparison）

$$
c(x, y) = \frac{2 \sigma_x \sigma_y + C_2}{\sigma_x^2 + \sigma_y^2 + C_2}
$$

对比度比较部分衡量两幅图像的对比度差异。

#### 2.3 结构比较（Structure Comparison）

$$
s(x, y) = \frac{\sigma_{xy} + C_3}{\sigma_x \sigma_y + C_3}
$$

结构比较部分衡量两幅图像的结构相似性。

局限性：协方差衡量的是两个数据集（在这里是两幅图像的像素值）之间的共同变化程度。但是，协方差的值会受到数据集的尺度影响。例如，对于两个数据集，如果它们的值都很大，协方差的值也会很大；如果它们的值都很小，协方差的值也会很小。因此，协方差的绝对值并不能直接反映两个数据集之间的相似性，需要进行标准化处理。

处理方式：用协方差值除去标准差做标准化

其他标准化：机器学习中的图像训练中的像素预处理归一化（x/255 [0, 1]）



### 3. 为什么 SSIM 能表示图片压缩效果

#### 3.1 考虑人类视觉系统

SSIM 模拟了人类视觉系统的感知特性，通过亮度、对比度和结构三个方面进行比较。这使得 SSIM 能更好地反映图像在视觉上的质量，而不仅仅是像素级别的差异。

#### 3.2 综合评估图像质量

SSIM 不仅考虑了像素值的差异，还考虑了图像的整体结构和纹理信息。这使得 SSIM 能够更全面地评估图像的质量，特别是在评估压缩算法的效果时。

#### 3.3 更加鲁棒

由于 SSIM 是基于局部窗口计算的，它对图像的局部失真（如边缘、纹理等）更加敏感，这些失真往往是压缩算法引入的。因此，SSIM 能更准确地反映压缩对图像质量的影响。

### 5. 结论

- **高 SSIM 值（接近 1）**：表示压缩图像与原始图像在亮度、对比度和结构上非常相似，图像质量较好。
- **低 SSIM 值（接近 0）**：表示压缩图像与原始图像在亮度、对比度和结构上差异较大，图像质量较差。

### 总结

SSIM 通过综合考虑图像的亮度、对比度和结构信息，能够更全面地评估图像的质量，特别是在反映人类视觉感知方面具有优势。相比于只关注像素差异的 PSNR，SSIM 更加适合用于评估图像压缩效果，因为它能够更准确地反映压缩对图像整体视觉质量的影响。
