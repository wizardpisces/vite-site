# 关于跨端

## 小程序（跨APP，双线程）

简介：一套代码跑在各个APP小程序：微信/支付宝/抖音等
代表框架: taro（类React/Vue等语法）,uniapp（类Vue语法）

### 原理
视图渲染：类React/Vue模板的**AST编译**成对应APP小程序的原生语法树（例如：微信就是微信小程序模板），再由各自APP渲染
API层面：把各端API **proxy**成统一的API调用，通过条件判断执行

## App（跨操作系统）
简介：一套代码跑在IOS跟Android系统
代表框架：React Native（类React语法），Flutter（Dart widget）

### 原理
#### React Native（三线程）
***开发者编写的js代码，通过 react native 的中间层转化为原生控件和操作***
* 代码执行：js代码交由JS Engine（JavascriptCore，Hermes，V8 etc）执行
* API调用（本地存储，定位，网络请求等）：Native <-> js代码通过**JSBridge**
* 视图渲染：通过 UI Manager 来创建视图的（基于 Virtual DOM ，RN 把不同平台创建视图的逻辑封装了一层，不同平台通过 Bridge 调用 UI Manager 来创建不同的 Native 视图）；所以依赖原生渲染层；（ps:在浏览器 JavaScript 可以调用 DOM API 完成创建 UI 的工作）

三线程
* JS thread： 负责 JS 和原生代码的交互线程，因为 JS 是单线程模型，所以需要一个单独的线程来驱动，并且 JS 和 Native 交互是异步的。
* Shadow thread: 这个线程是负责 Native 布局，提供给 yoga 引擎使用。
* UI thread：这个可以看作是主线程，可以看作是 UI Manager 线程，负责页面的交互和控件绘制逻辑。

***Bridge 的作用就是给 React Native 内嵌的 JS Engine 提供原生接口的扩展供 JS 调用***

#### Flutter

* 代码执行：使用dart，不需要JS Engine，需要flutter虚拟机
* API调用：dart可以AOT编译成平台原生代码，所以不需要bridge进行交互
* 视图渲染：flutter不适用平台原生控件，而是使用自身渲染引擎（skia）绘制widget（依赖平台的canvas能力），


# Reference
* [移动端跨平台开发的深度解析](https://juejin.cn/post/6844903630584152072)
* [RN原理分析](https://juejin.cn/post/6916452544956858382#heading-8)

***本文属于个人的见解，酌情观看***